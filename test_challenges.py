import pytest
from testbook import testbook
import numpy as np

# --- YOUR TEST DATA ---
test_1 = [21.69, 19.72, 31.66, 18.33, 20.13, 30.54, 27.4, 27.08, 32.72, 22.01, 22.6, 26.71, 20.45, 20.22, 30.29, 16.95, 21.84, 19.69, 16.8, 25.81, 28.88, 22.0, 18.24, 15.04, 30.61, 20.18, 29.32, 24.27, 26.94, 18.08, 23.17, 26.19, 23.19, 20.13, 32.45, 15.52, 26.77, 27.1, 15.26, 20.42, 25.5, 21.2, 30.34, 33.99, 32.11, 15.01, 33.48, 25.5, 32.63, 20.94, 20.31, 15.59, 22.2, 32.15, 23.87]
test_2 = [27.75, 16.4, 29.08, 24.92, 21.12, 16.09, 22.43, 21.39, 25.91, 18.22, 24.02, 28.69, 20.8, 21.69, 19.52, 21.79, 31.37, 15.61, 17.84, 32.72, 16.75, 28.69, 24.65, 33.94, 33.99, 16.84, 34.32, 23.61, 30.3, 29.27, 17.7, 31.72, 33.52, 17.27, 24.32, 29.06, 24.88, 22.47, 28.61, 20.92, 34.78, 29.38, 19.66, 18.7, 16.42, 17.9, 15.84, 22.37, 29.11, 31.83, 17.66, 33.56, 19.71, 28.66, 25.65, 29.92, 31.85, 26.82, 15.99, 16.58, 31.77, 30.25, 28.49, 17.45, 20.11, 26.89, 23.37, 28.35, 29.81, 17.12, 21.28, 20.66]
test_3 = [21.42, 30.71, 19.27, 25.24, 16.03, 32.8, 24.24, 33.89, 25.49, 15.61, 27.62, 17.45, 27.03, 24.34, 29.99, 33.29, 24.91, 16.01, 33.17, 28.4, 18.81, 34.57, 19.06, 15.59, 20.66, 30.76, 29.58, 27.24, 27.61, 17.17, 22.87, 18.57, 23.41, 19.94, 23.16, 20.94, 29.35, 21.45, 26.22, 32.93, 30.54, 31.69, 20.73, 21.05, 33.25, 20.63, 25.63, 24.55, 19.22, 31.28, 29.51, 24.65, 28.14, 23.4, 28.47, 18.86, 34.07, 23.27, 34.66, 15.16, 21.07, 34.71, 34.2, 23.9, 21.96, 21.28, 21.7, 18.11, 24.14, 19.16, 32.02, 17.82, 15.72, 28.89, 33.68, 24.09, 17.93, 29.49, 25.14, 30.44, 31.45, 27.56, 33.75, 20.92, 24.52, 22.79, 32.61, 16.44, 24.77, 16.95, 31.01, 18.15, 24.02, 22.62, 16.46, 21.39, 19.33, 24.96, 20.52, 15.55, 32.76, 21.06]
test_4 = [24.89, 19.4, 24.55, 15.79, 34.35, 28.89, 18.58, 29.37, 34.24, 29.02, 32.34, 27.59, 20.29, 23.63, 34.33, 29.95, 31.85, 27.28, 30.16, 21.41, 16.72, 26.97, 30.06, 33.83, 32.95, 20.57, 20.73, 27.88, 21.19, 29.98, 23.46, 18.15, 21.59, 22.68, 21.81, 23.61, 34.87, 16.92, 20.84, 26.53, 17.66, 29.0, 27.28, 33.37, 30.43, 15.33, 33.97, 16.87, 25.04, 33.21, 22.42, 23.11, 20.83, 18.34, 33.51, 29.04, 28.2, 19.7, 27.26, 32.09, 31.56, 29.11, 23.25, 21.66]

ans_1 = [-0.4262785080840019, -0.7863570638718066, 1.3960479899893017, -1.0404226438439124, -0.7114168568296747, 1.1913332780693315, 0.6174009607222729, 0.5589110430308528, 1.5897958423421301, -0.3677885903925819, -0.25994780464902634, 0.491282075700149, -0.6529269391382547, -0.6949665674789629, 1.1456380298729096, -1.2926604138881608, -0.39886135916614907, -0.7918404936553768, -1.3200775628060135, 0.32677918219302987, 0.8879168300450904, -0.369616400320439, -1.056872933194624, -1.6417721101088238, 1.2041279475643296, -0.7022778071903902, 0.9683404668707931, 0.045296453303071374, 0.5333217040408571, -1.086117892040334, -0.15576263876118443, 0.39623595945159157, -0.15210701890547076, -0.7114168568296747, 1.5404449742899953, -1.5540372335716937, 0.50224893526729, 0.5625666628865672, -1.6015602916959724, -0.6584103689218249, 0.270117074429467, -0.5158411945489891, 1.154777079512194, 1.8219277031799537, 1.4782994367428608, -1.6472555398923943, 1.7287093968592522, 0.270117074429467, 1.5733455529914189, -0.5633642526732675, -0.678516278128251, -1.5412425640766956, -0.3330602017633017, 1.4856106764542882, -0.027815943811203343]
ans_2 = [0.5717441385873722, -1.3760997354010396, 0.7999936850547363, 0.08607029159290505, -0.5660712697424223, -1.429300757509974, -0.341254047282086, -0.5197348956475438, 0.25597032994079266, -1.0637582507614882, -0.06838428872335701, 0.7330633669176901, -0.6209884538548709, -0.46825003554212313, -0.8406571903046656, -0.4510884155069833, 1.1929947838594472, -1.511676533678647, -1.1289724068950207, 1.4246766543338394, -1.3160340652780487, 0.7330633669176901, 0.039733917498026, 1.6340484187625495, 1.6426292287801203, -1.3005886072464226, 1.6992625748960826, -0.1387469308674318, 1.0093654494834472, 0.832600763121503, -1.1529986749442172, 1.2530604539824375, 1.5619696146149615, -1.2267936410953197, -0.016899428617936328, 0.7965613610477084, 0.07920564357884852, -0.3343893992680301, 0.7193340708895777, -0.6003945098127025, 1.7782060270577276, 0.8514785451601571, -0.8166309222554692, -0.9813824745928151, -1.3726674113940112, -1.1186754348739367, -1.4722048075978245, -0.3515510193031699, 0.8051421710652786, 1.2719382360210916, -1.159863322958273, 1.5688342626290175, -0.808050112237899, 0.7279148809071478, 0.2113501178494279, 0.9441512933499145, 1.2753705600281202, 0.4121410722605684, -1.4464623775451142, -1.3452088193377874, 1.2616412640000076, 1.0007846394658768, 0.6987401268474093, -1.1959027250320675, -0.7394036320973385, 0.4241542062851666, -0.17993481895176802, 0.6747138587982136, 0.9252735113112598, -1.2525360711480298, -0.5386126776861979, -0.6450147219040673]
ans_3 = [-0.5749740673894418, 1.0477145398802956, -0.9505155642279713, 0.09226710373761872, -1.5164478664404524, 1.4127758089000746, -0.08240335990820881, 1.603166614274027, 0.1359347196490756, -1.5898094611717002, 0.5079828072146887, -1.2684158080633776, 0.40492723366365047, -0.0649363135436258, 0.9219518060552995, 1.4983643360865304, 0.034625850734495936, -1.5199412757133688, 1.4774038804490315, 0.6442257688584337, -1.030863977505052, 1.7219425295531898, -0.9871963615935954, -1.5933028704446166, -0.707723619760271, 1.0564480630625872, 0.8503369159605101, 0.44160803102927376, 0.5062361025782302, -1.3173235378842088, -0.3217018951029921, -1.0727848887800506, -0.22737984473424536, -0.8334863535852667, -0.27104746064570223, -0.6588158899394392, 0.8101627093219703, -0.5697339534800674, 0.26344415811052974, 1.4354829691740325, 1.0180205610605046, 1.2188915942532068, -0.6954966873050631, -0.6396021389383982, 1.4913775175406974, -0.712963733669646, 0.16038858455949154, -0.028255516178001875, -0.9592490874102629, 1.1472767041584173, 0.8381099835053027, -0.010788469813419497, 0.5988114483105189, -0.2291265493707039, 0.6564527013136416, -1.0221304543227607, 1.6346072977302761, -0.2518337096446613, 1.7376628712813136, -1.6684111698123225, -0.6361087296654817, 1.7463963944636058, 1.657314458004234, -0.14179131754779015, -0.48065201702069515, -0.5994279322998578, -0.5260663375686105, -1.1531333020571313, -0.09987040627279119, -0.9697293152290123, 1.2765328472563302, -1.2037877365144212, -1.570595710170659, 0.7298142960448896, 1.5664858169084033, -0.10860392945508268, -1.1845739855133803, 0.8346165742323857, 0.07480005737303634, 1.0005535146959224, 1.1769706829782078, 0.4975025793959386, 1.5787127493636113, -0.6623092992123556, -0.0334956300873769, -0.33567553219465857, 1.3795884208073677, -1.4448329763456629, 0.010171985824079981, -1.3557510398862913, 1.100115678974044, -1.1461464835112984, -0.12083086191029066, -0.3653695110144489, -1.4413395670727465, -0.5802141812988169, -0.940035336409222, 0.04335937391678743, -0.732177484670687, -1.6002896889904497, 1.4057889903542415, -0.6378554343019402]
ans_4 = [-0.16265130019745094, -1.1390593104037834, -0.22312101303354434, -1.781105379045834, 1.5198295334185603, 0.5487570861095304, -1.2848980295967145, 0.6341260924663683, 1.5002658027951183, 0.5718778586645071, 1.1623468192993025, 0.3175493605597614, -0.9807709444504799, -0.3867449418841504, 1.5162724914870247, 0.7372803084808803, 1.0751992919766968, 0.26241521062097056, 0.774629248761997, -0.7815765962845248, -1.6157029292294607, 0.20728106068217908, 0.7568440391043222, 1.427346443198652, 1.270836598211117, -0.9309723574089909, -0.9025160219567117, 0.36912646856701736, -0.8207040575314086, 0.7426158713781829, -0.4169797983021967, -1.361374431124715, -0.7495632189007108, -0.5557044336320583, -0.7104357576538269, -0.3903019838156852, 1.612312623638467, -1.5801325099141112, -0.8829522913332697, 0.12902613818841155, -1.44852195844732, 0.5683208167329724, 0.26241521062097056, 1.3455344787733492, 0.8226493148377182, -1.8629173434711366, 1.4522457367193966, -1.5890251147429486, -0.1359734857109394, 1.3170781433210705, -0.6019459787420117, -0.47922803210405784, -0.8847308122990375, -1.3275825327751332, 1.3704337722940936, 0.575434900596042, 0.42603913947157596, -1.0857036814307595, 0.25885816868943573, 1.1178837951551162, 1.0236221839694402, 0.5878845473564143, -0.4543287385833134, -0.7371135721403385]

# Package them into a list of tuples for pytest to iterate through
TEST_CASES = [
    (test_1, ans_1),
    (test_2, ans_2),
    (test_3, ans_3),
    (test_4, ans_4)
]

# Set up the notebook environment once for the whole test suite
@pytest.fixture(scope='module')
def tb():
    # Make sure this matches the exact name of the starter notebook!
    with testbook('ZScoreNormalization.ipynb', execute=True) as tb:
        yield tb

# The parameterize decorator feeds the tuples one by one into the test
@pytest.mark.parametrize("input_data, expected_output", TEST_CASES)
def test_normalize(tb, input_data, expected_output):
    # 1. Inject the specific input list into the notebook's memory
    tb.inject(f"test_data = {input_data}")
    
    # 2. Reference the student's function
    student_function = tb.ref("normalize")
    
    # 3. Call the function using the injected data
    result = student_function(tb.ref("test_data"))
    
    # 4. Assert with a tolerance of 3 decimal places 
    np.testing.assert_almost_equal(result, expected_output, decimal=3)
